{"version":3,"sources":["/home/piotr/Desktop/guitar-crm/jest.setup.js"],"sourcesContent":["console.log('Jest setup starting...');\nimport '@testing-library/jest-dom';\n\n// Polyfill for encoding APIs\nimport { TextEncoder, TextDecoder } from 'util';\nglobal.TextEncoder = TextEncoder;\nglobal.TextDecoder = TextDecoder;\n\n// Do not override global fetch. Supabase client relies on a real fetch implementation.\n// If needed, individual tests should mock fetch per-suite.\n\n// Minimal Request shim to keep Next.js server imports from crashing in skipped suites\nif (typeof globalThis.Request === 'undefined') {\n  globalThis.Request = class {};\n}\n\n// Mock environment variables for Supabase ONLY if not already set\nif (!process.env.NEXT_PUBLIC_SUPABASE_URL) {\n  process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://example.supabase.co';\n}\nif (!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'test-anon-key';\n}\nif (!process.env.NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY && !process.env.SUPABASE_SERVICE_ROLE_KEY) {\n  process.env.NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY = 'test-service-role-key';\n}\n\n// Mock Supabase client methods to prevent database calls in tests\njest.mock('@/lib/supabase-browser', () => ({\n  supabase: {\n    from: jest.fn(() => ({\n      select: jest.fn(() => ({\n        limit: jest.fn(() => Promise.resolve({ data: [], error: null })),\n      })),\n    })),\n    auth: {\n      getUser: jest.fn(() => Promise.resolve({ data: { user: null }, error: null })),\n      signInWithPassword: jest.fn(),\n      signOut: jest.fn(),\n    },\n  },\n}));\n\n// Fix for Console Ninja instrumentation in tests\n// The instrumentation adds calls to a global function `oo_oo` which might be missing or broken in the test environment.\n// We define it here to prevent crashes.\nif (typeof global.oo_oo === 'undefined') {\n  global.oo_oo = function () {\n    return [];\n  };\n}\nif (typeof global.oo_tx === 'undefined') {\n  global.oo_tx = function () {\n    return [];\n  };\n}\n\n// Mock console to avoid issues with instrumentation\n// global.console.log = (...args) => {};\n// global.console.error = (...args) => {};\n// global.console.warn = (...args) => {};\n// global.console.info = (...args) => {};\n// global.console.debug = (...args) => {};\n\n// Provide a minimal default fetch for relative API routes used by component tests.\n// Delegates to existing fetch if present; otherwise returns a harmless default for '/api/*'.\nconst __originalFetch = globalThis.fetch;\nglobalThis.fetch = async (input, init) => {\n  const url = typeof input === 'string' ? input : input?.url;\n  if (typeof url === 'string' && url.startsWith('/api/')) {\n    return {\n      ok: true,\n      status: 200,\n      json: async () => [],\n      text: async () => '[]',\n    };\n  }\n  if (typeof __originalFetch === 'function') {\n    return __originalFetch(input, init);\n  }\n  throw new Error('fetch is not defined');\n};\n\n// Mock Next.js router\njest.mock('next/navigation', () => ({\n  useRouter() {\n    return {\n      push: jest.fn(),\n      replace: jest.fn(),\n      prefetch: jest.fn(),\n      back: jest.fn(),\n      forward: jest.fn(),\n      refresh: jest.fn(),\n    };\n  },\n  useSearchParams() {\n    return new URLSearchParams();\n  },\n  usePathname() {\n    return '/';\n  },\n}));\n\n// Mock next/server to avoid requiring global Response/Request in skipped route tests\njest.mock('next/server', () => {\n  return {\n    NextRequest: class {\n      constructor(url, init) {\n        this.url = url;\n        this.method = init?.method || 'GET';\n        this.body = init?.body;\n        this.headers = new Headers(init?.headers);\n        this.nextUrl = new URL(url);\n      }\n      async json() {\n        return typeof this.body === 'string' ? JSON.parse(this.body) : this.body;\n      }\n    },\n    NextResponse: {\n      json: (data, init) => {\n        return {\n          ok: true,\n          status: init?.status || 200,\n          json: async () => data,\n          headers: new Headers(init?.headers),\n        };\n      },\n    },\n  };\n});\n\n// Mock Supabase client\njest.mock('@/lib/supabase/client', () => ({\n  createClient: jest.fn(() => ({\n    from: jest.fn(() => ({\n      select: jest.fn().mockReturnThis(),\n      insert: jest.fn().mockReturnThis(),\n      update: jest.fn().mockReturnThis(),\n      delete: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      limit: jest.fn().mockReturnThis(),\n      order: jest.fn().mockReturnThis(),\n      single: jest.fn().mockReturnThis(),\n    })),\n    auth: {\n      getUser: jest.fn().mockResolvedValue({ data: { user: null }, error: null }),\n      getSession: jest.fn().mockResolvedValue({ data: { session: null }, error: null }),\n      signIn: jest.fn(),\n      signOut: jest.fn(),\n      signUp: jest.fn(),\n      onAuthStateChange: jest.fn(() => ({\n        data: { subscription: { unsubscribe: jest.fn() } },\n      })),\n    },\n  })),\n}));\n\n// Mock window.matchMedia\nif (typeof window !== 'undefined') {\n  Object.defineProperty(window, 'matchMedia', {\n    writable: true,\n    value: jest.fn().mockImplementation((query) => ({\n      matches: false,\n      media: query,\n      onchange: null,\n      addListener: jest.fn(), // Deprecated\n      removeListener: jest.fn(), // Deprecated\n      addEventListener: jest.fn(),\n      removeEventListener: jest.fn(),\n      dispatchEvent: jest.fn(),\n    })),\n  });\n}\n\n// Mock IntersectionObserver\nglobal.IntersectionObserver = class IntersectionObserver {\n  constructor() {}\n  disconnect() {}\n  observe() {}\n  unobserve() {}\n};\n\n// Mock ResizeObserver\nglobal.ResizeObserver = class ResizeObserver {\n  constructor() {}\n  disconnect() {}\n  observe() {}\n  unobserve() {}\n};\n\n// Mock fetch API for Jest tests\nglobal.fetch = jest.fn(() =>\n  Promise.resolve({\n    ok: true,\n    status: 200,\n    json: () => Promise.resolve({ data: [], error: null }),\n    text: () => Promise.resolve(''),\n    headers: new Headers(),\n    redirected: false,\n    statusText: 'OK',\n    type: 'basic',\n    url: '',\n    clone: jest.fn(),\n    body: null,\n    bodyUsed: false,\n    arrayBuffer: () => Promise.resolve(new ArrayBuffer(0)),\n    blob: () => Promise.resolve(new Blob()),\n    formData: () => Promise.resolve(new FormData()),\n  })\n);\n\n// Global test utilities\nglobal.testUtils = {\n  // Helper to create mock user data\n  createMockUser: (overrides = {}) => ({\n    id: '1',\n    email: 'test@example.com',\n    firstName: 'Test',\n    lastName: 'User',\n    isAdmin: false,\n    isTeacher: false,\n    isStudent: true,\n    isActive: true,\n    canEdit: false,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n    ...overrides,\n  }),\n\n  // Helper to create mock song data\n  createMockSong: (overrides = {}) => ({\n    id: '1',\n    title: 'Test Song',\n    author: 'Test Artist',\n    level: 'beginner',\n    key: 'C',\n    chords: 'C G Am F',\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n    ...overrides,\n  }),\n\n  // Helper to create mock lesson data\n  createMockLesson: (overrides = {}) => ({\n    id: '1',\n    student_id: '1',\n    teacher_id: '2',\n    date: new Date().toISOString().split('T')[0],\n    start_time: '10:00',\n    status: 'SCHEDULED',\n    title: 'Test Lesson',\n    notes: 'Test notes',\n    lesson_number: 1,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n    ...overrides,\n  }),\n};\n\n// Polyfill for mysterious instrumentation (Console Ninja / OpenObserve?) causing ReferenceErrors\n// These functions are injected into the code during test execution but not defined in the global scope\nglobal.oo_tx = (id, ...args) => args;\nglobal.oo_oo = (id, ...args) => args;\n\nconsole.log('Jest setup finished.');\n"],"names":["jest","mock","supabase","from","fn","select","limit","Promise","resolve","data","error","auth","getUser","user","signInWithPassword","signOut","useRouter","push","replace","prefetch","back","forward","refresh","useSearchParams","URLSearchParams","usePathname","NextRequest","url","init","method","body","headers","Headers","nextUrl","URL","json","JSON","parse","NextResponse","ok","status","createClient","mockReturnThis","insert","update","delete","eq","order","single","mockResolvedValue","getSession","session","signIn","signUp","onAuthStateChange","subscription","unsubscribe","console","log","global","TextEncoder","TextDecoder","globalThis","Request","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY","SUPABASE_SERVICE_ROLE_KEY","oo_oo","oo_tx","__originalFetch","fetch","input","startsWith","text","Error","window","Object","defineProperty","writable","value","mockImplementation","query","matches","media","onchange","addListener","removeListener","addEventListener","removeEventListener","dispatchEvent","IntersectionObserver","disconnect","observe","unobserve","ResizeObserver","redirected","statusText","type","clone","bodyUsed","arrayBuffer","ArrayBuffer","blob","Blob","formData","FormData","testUtils","createMockUser","overrides","id","email","firstName","lastName","isAdmin","isTeacher","isStudent","isActive","canEdit","created_at","Date","toISOString","updated_at","createMockSong","title","author","level","key","chords","createMockLesson","student_id","teacher_id","date","split","start_time","notes","lesson_number","args"],"mappings":"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"}