{"version":3,"sources":["/home/piotr/Desktop/guitar-crm/lib/getUserWithRolesSSR.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/server';\n\nexport async function getUserWithRolesSSR() {\n  const supabase = await createClient();\n  const {\n    data: { user },\n    error: userError,\n  } = await supabase.auth.getUser();\n  if (userError) {\n    // Optionally log or handle error\n    return {\n      user: null,\n      isAdmin: false,\n      isTeacher: false,\n      isStudent: false,\n    };\n  }\n\n  if (!user) {\n    return {\n      user: null,\n      isAdmin: false,\n      isTeacher: false,\n      isStudent: false,\n    };\n  }\n\n  // Fetch roles from user_roles table\n  const { data: roles, error: rolesError } = await supabase\n    .from('user_roles')\n    .select('role')\n    .eq('user_id', user.id);\n\n  if (rolesError) {\n    // Profile error - user exists but no profile record (handle gracefully in calling code)\n  }\n\n  if (roles) {\n    return {\n      user,\n      isAdmin: roles.some((r) => r.role === 'admin'),\n      isTeacher: roles.some((r) => r.role === 'teacher'),\n      isStudent: roles.some((r) => r.role === 'student'),\n    };\n  }\n\n  // Fallback: if user is development admin, set isAdmin true\n  if (user.email === 'p.romanczuk@gmail.com') {\n    return {\n      user,\n      isAdmin: true,\n      isTeacher: true,\n      isStudent: false,\n    };\n  }\n\n  return {\n    user,\n    isAdmin: false,\n    isTeacher: false,\n    isStudent: false,\n  };\n}\n"],"names":["getUserWithRolesSSR","supabase","createClient","data","user","error","userError","auth","getUser","isAdmin","isTeacher","isStudent","roles","rolesError","from","select","eq","id","some","r","role","email"],"mappings":";;;;+BAEsBA;;;eAAAA;;;wBAFO;AAEtB,eAAeA;IACpB,MAAMC,WAAW,MAAMC,IAAAA,oBAAY;IACnC,MAAM,EACJC,MAAM,EAAEC,IAAI,EAAE,EACdC,OAAOC,SAAS,EACjB,GAAG,MAAML,SAASM,IAAI,CAACC,OAAO;IAC/B,IAAIF,WAAW;QACb,iCAAiC;QACjC,OAAO;YACLF,MAAM;YACNK,SAAS;YACTC,WAAW;YACXC,WAAW;QACb;IACF;IAEA,IAAI,CAACP,MAAM;QACT,OAAO;YACLA,MAAM;YACNK,SAAS;YACTC,WAAW;YACXC,WAAW;QACb;IACF;IAEA,oCAAoC;IACpC,MAAM,EAAER,MAAMS,KAAK,EAAEP,OAAOQ,UAAU,EAAE,GAAG,MAAMZ,SAC9Ca,IAAI,CAAC,cACLC,MAAM,CAAC,QACPC,EAAE,CAAC,WAAWZ,KAAKa,EAAE;IAExB,IAAIJ,YAAY;IACd,wFAAwF;IAC1F;IAEA,IAAID,OAAO;QACT,OAAO;YACLR;YACAK,SAASG,MAAMM,IAAI,CAAC,CAACC,IAAMA,EAAEC,IAAI,KAAK;YACtCV,WAAWE,MAAMM,IAAI,CAAC,CAACC,IAAMA,EAAEC,IAAI,KAAK;YACxCT,WAAWC,MAAMM,IAAI,CAAC,CAACC,IAAMA,EAAEC,IAAI,KAAK;QAC1C;IACF;IAEA,2DAA2D;IAC3D,IAAIhB,KAAKiB,KAAK,KAAK,yBAAyB;QAC1C,OAAO;YACLjB;YACAK,SAAS;YACTC,WAAW;YACXC,WAAW;QACb;IACF;IAEA,OAAO;QACLP;QACAK,SAAS;QACTC,WAAW;QACXC,WAAW;IACb;AACF"}