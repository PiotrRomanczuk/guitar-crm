59d120adbdf39bf83ce52f8da3507199
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "getUserWithRolesSSR", {
    enumerable: true,
    get: function() {
        return getUserWithRolesSSR;
    }
});
const _server = require("./supabase/server");
async function getUserWithRolesSSR() {
    const supabase = await (0, _server.createClient)();
    const { data: { user }, error: userError } = await supabase.auth.getUser();
    if (userError) {
        // Optionally log or handle error
        return {
            user: null,
            isAdmin: false,
            isTeacher: false,
            isStudent: false
        };
    }
    if (!user) {
        return {
            user: null,
            isAdmin: false,
            isTeacher: false,
            isStudent: false
        };
    }
    // Fetch roles from user_roles table
    const { data: roles, error: rolesError } = await supabase.from('user_roles').select('role').eq('user_id', user.id);
    if (rolesError) {
    // Profile error - user exists but no profile record (handle gracefully in calling code)
    }
    if (roles) {
        return {
            user,
            isAdmin: roles.some((r)=>r.role === 'admin'),
            isTeacher: roles.some((r)=>r.role === 'teacher'),
            isStudent: roles.some((r)=>r.role === 'student')
        };
    }
    // Fallback: if user is development admin, set isAdmin true
    if (user.email === 'p.romanczuk@gmail.com') {
        return {
            user,
            isAdmin: true,
            isTeacher: true,
            isStudent: false
        };
    }
    return {
        user,
        isAdmin: false,
        isTeacher: false,
        isStudent: false
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3Bpb3RyL0Rlc2t0b3AvZ3VpdGFyLWNybS9saWIvZ2V0VXNlcldpdGhSb2xlc1NTUi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlcldpdGhSb2xlc1NTUigpIHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcbiAgY29uc3Qge1xuICAgIGRhdGE6IHsgdXNlciB9LFxuICAgIGVycm9yOiB1c2VyRXJyb3IsXG4gIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcbiAgaWYgKHVzZXJFcnJvcikge1xuICAgIC8vIE9wdGlvbmFsbHkgbG9nIG9yIGhhbmRsZSBlcnJvclxuICAgIHJldHVybiB7XG4gICAgICB1c2VyOiBudWxsLFxuICAgICAgaXNBZG1pbjogZmFsc2UsXG4gICAgICBpc1RlYWNoZXI6IGZhbHNlLFxuICAgICAgaXNTdHVkZW50OiBmYWxzZSxcbiAgICB9O1xuICB9XG5cbiAgaWYgKCF1c2VyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXI6IG51bGwsXG4gICAgICBpc0FkbWluOiBmYWxzZSxcbiAgICAgIGlzVGVhY2hlcjogZmFsc2UsXG4gICAgICBpc1N0dWRlbnQ6IGZhbHNlLFxuICAgIH07XG4gIH1cblxuICAvLyBGZXRjaCByb2xlcyBmcm9tIHVzZXJfcm9sZXMgdGFibGVcbiAgY29uc3QgeyBkYXRhOiByb2xlcywgZXJyb3I6IHJvbGVzRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3VzZXJfcm9sZXMnKVxuICAgIC5zZWxlY3QoJ3JvbGUnKVxuICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpO1xuXG4gIGlmIChyb2xlc0Vycm9yKSB7XG4gICAgLy8gUHJvZmlsZSBlcnJvciAtIHVzZXIgZXhpc3RzIGJ1dCBubyBwcm9maWxlIHJlY29yZCAoaGFuZGxlIGdyYWNlZnVsbHkgaW4gY2FsbGluZyBjb2RlKVxuICB9XG5cbiAgaWYgKHJvbGVzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXIsXG4gICAgICBpc0FkbWluOiByb2xlcy5zb21lKChyKSA9PiByLnJvbGUgPT09ICdhZG1pbicpLFxuICAgICAgaXNUZWFjaGVyOiByb2xlcy5zb21lKChyKSA9PiByLnJvbGUgPT09ICd0ZWFjaGVyJyksXG4gICAgICBpc1N0dWRlbnQ6IHJvbGVzLnNvbWUoKHIpID0+IHIucm9sZSA9PT0gJ3N0dWRlbnQnKSxcbiAgICB9O1xuICB9XG5cbiAgLy8gRmFsbGJhY2s6IGlmIHVzZXIgaXMgZGV2ZWxvcG1lbnQgYWRtaW4sIHNldCBpc0FkbWluIHRydWVcbiAgaWYgKHVzZXIuZW1haWwgPT09ICdwLnJvbWFuY3p1a0BnbWFpbC5jb20nKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXIsXG4gICAgICBpc0FkbWluOiB0cnVlLFxuICAgICAgaXNUZWFjaGVyOiB0cnVlLFxuICAgICAgaXNTdHVkZW50OiBmYWxzZSxcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB1c2VyLFxuICAgIGlzQWRtaW46IGZhbHNlLFxuICAgIGlzVGVhY2hlcjogZmFsc2UsXG4gICAgaXNTdHVkZW50OiBmYWxzZSxcbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJnZXRVc2VyV2l0aFJvbGVzU1NSIiwic3VwYWJhc2UiLCJjcmVhdGVDbGllbnQiLCJkYXRhIiwidXNlciIsImVycm9yIiwidXNlckVycm9yIiwiYXV0aCIsImdldFVzZXIiLCJpc0FkbWluIiwiaXNUZWFjaGVyIiwiaXNTdHVkZW50Iiwicm9sZXMiLCJyb2xlc0Vycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwiaWQiLCJzb21lIiwiciIsInJvbGUiLCJlbWFpbCJdLCJtYXBwaW5ncyI6Ijs7OzsrQkFFc0JBOzs7ZUFBQUE7Ozt3QkFGTztBQUV0QixlQUFlQTtJQUNwQixNQUFNQyxXQUFXLE1BQU1DLElBQUFBLG9CQUFZO0lBQ25DLE1BQU0sRUFDSkMsTUFBTSxFQUFFQyxJQUFJLEVBQUUsRUFDZEMsT0FBT0MsU0FBUyxFQUNqQixHQUFHLE1BQU1MLFNBQVNNLElBQUksQ0FBQ0MsT0FBTztJQUMvQixJQUFJRixXQUFXO1FBQ2IsaUNBQWlDO1FBQ2pDLE9BQU87WUFDTEYsTUFBTTtZQUNOSyxTQUFTO1lBQ1RDLFdBQVc7WUFDWEMsV0FBVztRQUNiO0lBQ0Y7SUFFQSxJQUFJLENBQUNQLE1BQU07UUFDVCxPQUFPO1lBQ0xBLE1BQU07WUFDTkssU0FBUztZQUNUQyxXQUFXO1lBQ1hDLFdBQVc7UUFDYjtJQUNGO0lBRUEsb0NBQW9DO0lBQ3BDLE1BQU0sRUFBRVIsTUFBTVMsS0FBSyxFQUFFUCxPQUFPUSxVQUFVLEVBQUUsR0FBRyxNQUFNWixTQUM5Q2EsSUFBSSxDQUFDLGNBQ0xDLE1BQU0sQ0FBQyxRQUNQQyxFQUFFLENBQUMsV0FBV1osS0FBS2EsRUFBRTtJQUV4QixJQUFJSixZQUFZO0lBQ2Qsd0ZBQXdGO0lBQzFGO0lBRUEsSUFBSUQsT0FBTztRQUNULE9BQU87WUFDTFI7WUFDQUssU0FBU0csTUFBTU0sSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUVDLElBQUksS0FBSztZQUN0Q1YsV0FBV0UsTUFBTU0sSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUVDLElBQUksS0FBSztZQUN4Q1QsV0FBV0MsTUFBTU0sSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUVDLElBQUksS0FBSztRQUMxQztJQUNGO0lBRUEsMkRBQTJEO0lBQzNELElBQUloQixLQUFLaUIsS0FBSyxLQUFLLHlCQUF5QjtRQUMxQyxPQUFPO1lBQ0xqQjtZQUNBSyxTQUFTO1lBQ1RDLFdBQVc7WUFDWEMsV0FBVztRQUNiO0lBQ0Y7SUFFQSxPQUFPO1FBQ0xQO1FBQ0FLLFNBQVM7UUFDVEMsV0FBVztRQUNYQyxXQUFXO0lBQ2I7QUFDRiJ9