381f2a40145a469f7f62850759a0a9a0
/**
 * Tests for getUserWithRolesSSR
 * Using development credentials from development_credentials.txt
 */ "use strict";
// Mock dependencies
jest.mock('next/headers');
jest.mock('@supabase/ssr');
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _getUserWithRolesSSR = require("./getUserWithRolesSSR");
const _headers = require("next/headers");
const _ssr = require("@supabase/ssr");
describe('getUserWithRolesSSR', ()=>{
    const mockCookieStore = {
        getAll: jest.fn(),
        set: jest.fn(),
        get: jest.fn()
    };
    const mockSupabaseClient = {
        auth: {
            getUser: jest.fn()
        },
        from: jest.fn()
    };
    beforeEach(()=>{
        jest.clearAllMocks();
        _headers.cookies.mockResolvedValue(mockCookieStore);
        _ssr.createServerClient.mockReturnValue(mockSupabaseClient);
    });
    describe('Admin User (p.romanczuk@gmail.com)', ()=>{
        it('returns user with admin and teacher roles', async ()=>{
            const mockUser = {
                id: 'admin-user-id',
                email: 'p.romanczuk@gmail.com',
                aud: 'authenticated',
                role: 'authenticated'
            };
            const mockRoles = [
                {
                    role: 'admin'
                },
                {
                    role: 'teacher'
                }
            ];
            mockSupabaseClient.auth.getUser.mockResolvedValue({
                data: {
                    user: mockUser
                },
                error: null
            });
            mockSupabaseClient.from.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockResolvedValue({
                        data: mockRoles,
                        error: null
                    })
                })
            });
            const result = await (0, _getUserWithRolesSSR.getUserWithRolesSSR)();
            expect(result).toEqual({
                user: mockUser,
                isAdmin: true,
                isTeacher: true,
                isStudent: false
            });
        });
    });
    describe('Teacher User (teacher@example.com)', ()=>{
        it('returns user with teacher role only', async ()=>{
            const mockUser = {
                id: 'teacher-user-id',
                email: 'teacher@example.com',
                aud: 'authenticated',
                role: 'authenticated'
            };
            const mockRoles = [
                {
                    role: 'teacher'
                }
            ];
            mockSupabaseClient.auth.getUser.mockResolvedValue({
                data: {
                    user: mockUser
                },
                error: null
            });
            mockSupabaseClient.from.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockResolvedValue({
                        data: mockRoles,
                        error: null
                    })
                })
            });
            const result = await (0, _getUserWithRolesSSR.getUserWithRolesSSR)();
            expect(result).toEqual({
                user: mockUser,
                isAdmin: false,
                isTeacher: true,
                isStudent: false
            });
        });
    });
    describe('Student User (student@example.com)', ()=>{
        it('returns user with student role only', async ()=>{
            const mockUser = {
                id: 'student-user-id',
                email: 'student@example.com',
                aud: 'authenticated',
                role: 'authenticated'
            };
            const mockRoles = [
                {
                    role: 'student'
                }
            ];
            mockSupabaseClient.auth.getUser.mockResolvedValue({
                data: {
                    user: mockUser
                },
                error: null
            });
            mockSupabaseClient.from.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockResolvedValue({
                        data: mockRoles,
                        error: null
                    })
                })
            });
            const result = await (0, _getUserWithRolesSSR.getUserWithRolesSSR)();
            expect(result).toEqual({
                user: mockUser,
                isAdmin: false,
                isTeacher: false,
                isStudent: true
            });
        });
    });
    describe('No User', ()=>{
        it('returns all roles false when no user is authenticated', async ()=>{
            mockSupabaseClient.auth.getUser.mockResolvedValue({
                data: {
                    user: null
                },
                error: null
            });
            const result = await (0, _getUserWithRolesSSR.getUserWithRolesSSR)();
            expect(result).toEqual({
                user: null,
                isAdmin: false,
                isTeacher: false,
                isStudent: false
            });
        });
    });
    describe('User with No Roles', ()=>{
        it('returns user with all roles false', async ()=>{
            const mockUser = {
                id: 'no-roles-user-id',
                email: 'user@example.com',
                aud: 'authenticated',
                role: 'authenticated'
            };
            mockSupabaseClient.auth.getUser.mockResolvedValue({
                data: {
                    user: mockUser
                },
                error: null
            });
            mockSupabaseClient.from.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockResolvedValue({
                        data: [],
                        error: null
                    })
                })
            });
            const result = await (0, _getUserWithRolesSSR.getUserWithRolesSSR)();
            expect(result).toEqual({
                user: mockUser,
                isAdmin: false,
                isTeacher: false,
                isStudent: false
            });
        });
    });
    describe('Database Error', ()=>{
        it('returns user with all roles false on error', async ()=>{
            const mockUser = {
                id: 'error-user-id',
                email: 'error@example.com',
                aud: 'authenticated',
                role: 'authenticated'
            };
            mockSupabaseClient.auth.getUser.mockResolvedValue({
                data: {
                    user: mockUser
                },
                error: null
            });
            mockSupabaseClient.from.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockResolvedValue({
                        data: null,
                        error: {
                            message: 'Database error'
                        }
                    })
                })
            });
            const result = await (0, _getUserWithRolesSSR.getUserWithRolesSSR)();
            expect(result).toEqual({
                user: mockUser,
                isAdmin: false,
                isTeacher: false,
                isStudent: false
            });
        });
    });
    describe('Database Error', ()=>{
        it('handles profile fetch error gracefully', async ()=>{
            const mockUser = {
                id: 'user-id',
                email: 'user@example.com',
                aud: 'authenticated',
                role: 'authenticated'
            };
            mockSupabaseClient.auth.getUser.mockResolvedValue({
                data: {
                    user: mockUser
                },
                error: null
            });
            mockSupabaseClient.from.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        single: jest.fn().mockResolvedValue({
                            data: null,
                            error: {
                                code: 'PGRST500',
                                message: 'Database error'
                            }
                        })
                    })
                })
            });
            const result = await (0, _getUserWithRolesSSR.getUserWithRolesSSR)();
            expect(result).toEqual({
                user: mockUser,
                isAdmin: false,
                isTeacher: false,
                isStudent: false
            });
        });
    });
    describe('Authentication Error', ()=>{
        it('returns null user when auth fails', async ()=>{
            mockSupabaseClient.auth.getUser.mockResolvedValue({
                data: {
                    user: null
                },
                error: {
                    message: 'Auth error'
                }
            });
            const result = await (0, _getUserWithRolesSSR.getUserWithRolesSSR)();
            expect(result).toEqual({
                user: null,
                isAdmin: false,
                isTeacher: false,
                isStudent: false
            });
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3Bpb3RyL0Rlc2t0b3AvZ3VpdGFyLWNybS9saWIvZ2V0VXNlcldpdGhSb2xlc1NTUi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdHMgZm9yIGdldFVzZXJXaXRoUm9sZXNTU1JcbiAqIFVzaW5nIGRldmVsb3BtZW50IGNyZWRlbnRpYWxzIGZyb20gZGV2ZWxvcG1lbnRfY3JlZGVudGlhbHMudHh0XG4gKi9cblxuaW1wb3J0IHsgZ2V0VXNlcldpdGhSb2xlc1NTUiB9IGZyb20gJ0AvbGliL2dldFVzZXJXaXRoUm9sZXNTU1InO1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXJDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3NyJztcblxuLy8gTW9jayBkZXBlbmRlbmNpZXNcbmplc3QubW9jaygnbmV4dC9oZWFkZXJzJyk7XG5qZXN0Lm1vY2soJ0BzdXBhYmFzZS9zc3InKTtcblxuZGVzY3JpYmUoJ2dldFVzZXJXaXRoUm9sZXNTU1InLCAoKSA9PiB7XG4gIGNvbnN0IG1vY2tDb29raWVTdG9yZSA9IHtcbiAgICBnZXRBbGw6IGplc3QuZm4oKSxcbiAgICBzZXQ6IGplc3QuZm4oKSxcbiAgICBnZXQ6IGplc3QuZm4oKSxcbiAgfTtcblxuICBjb25zdCBtb2NrU3VwYWJhc2VDbGllbnQgPSB7XG4gICAgYXV0aDoge1xuICAgICAgZ2V0VXNlcjogamVzdC5mbigpLFxuICAgIH0sXG4gICAgZnJvbTogamVzdC5mbigpLFxuICB9O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIChjb29raWVzIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0Nvb2tpZVN0b3JlKTtcbiAgICAoY3JlYXRlU2VydmVyQ2xpZW50IGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKG1vY2tTdXBhYmFzZUNsaWVudCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBZG1pbiBVc2VyIChwLnJvbWFuY3p1a0BnbWFpbC5jb20pJywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIHVzZXIgd2l0aCBhZG1pbiBhbmQgdGVhY2hlciByb2xlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgICBpZDogJ2FkbWluLXVzZXItaWQnLFxuICAgICAgICBlbWFpbDogJ3Aucm9tYW5jenVrQGdtYWlsLmNvbScsXG4gICAgICAgIGF1ZDogJ2F1dGhlbnRpY2F0ZWQnLFxuICAgICAgICByb2xlOiAnYXV0aGVudGljYXRlZCcsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrUm9sZXMgPSBbeyByb2xlOiAnYWRtaW4nIH0sIHsgcm9sZTogJ3RlYWNoZXInIH1dO1xuXG4gICAgICBtb2NrU3VwYWJhc2VDbGllbnQuYXV0aC5nZXRVc2VyLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0YTogeyB1c2VyOiBtb2NrVXNlciB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrU3VwYWJhc2VDbGllbnQuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgZGF0YTogbW9ja1JvbGVzLFxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFVzZXJXaXRoUm9sZXNTU1IoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHVzZXI6IG1vY2tVc2VyLFxuICAgICAgICBpc0FkbWluOiB0cnVlLFxuICAgICAgICBpc1RlYWNoZXI6IHRydWUsXG4gICAgICAgIGlzU3R1ZGVudDogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1RlYWNoZXIgVXNlciAodGVhY2hlckBleGFtcGxlLmNvbSknLCAoKSA9PiB7XG4gICAgaXQoJ3JldHVybnMgdXNlciB3aXRoIHRlYWNoZXIgcm9sZSBvbmx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAndGVhY2hlci11c2VyLWlkJyxcbiAgICAgICAgZW1haWw6ICd0ZWFjaGVyQGV4YW1wbGUuY29tJyxcbiAgICAgICAgYXVkOiAnYXV0aGVudGljYXRlZCcsXG4gICAgICAgIHJvbGU6ICdhdXRoZW50aWNhdGVkJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tSb2xlcyA9IFt7IHJvbGU6ICd0ZWFjaGVyJyB9XTtcblxuICAgICAgbW9ja1N1cGFiYXNlQ2xpZW50LmF1dGguZ2V0VXNlci5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgdXNlcjogbW9ja1VzZXIgfSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgbW9ja1N1cGFiYXNlQ2xpZW50LmZyb20ubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgIGRhdGE6IG1vY2tSb2xlcyxcbiAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRVc2VyV2l0aFJvbGVzU1NSKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICB1c2VyOiBtb2NrVXNlcixcbiAgICAgICAgaXNBZG1pbjogZmFsc2UsXG4gICAgICAgIGlzVGVhY2hlcjogdHJ1ZSxcbiAgICAgICAgaXNTdHVkZW50OiBmYWxzZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU3R1ZGVudCBVc2VyIChzdHVkZW50QGV4YW1wbGUuY29tKScsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyB1c2VyIHdpdGggc3R1ZGVudCByb2xlIG9ubHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHtcbiAgICAgICAgaWQ6ICdzdHVkZW50LXVzZXItaWQnLFxuICAgICAgICBlbWFpbDogJ3N0dWRlbnRAZXhhbXBsZS5jb20nLFxuICAgICAgICBhdWQ6ICdhdXRoZW50aWNhdGVkJyxcbiAgICAgICAgcm9sZTogJ2F1dGhlbnRpY2F0ZWQnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja1JvbGVzID0gW3sgcm9sZTogJ3N0dWRlbnQnIH1dO1xuXG4gICAgICBtb2NrU3VwYWJhc2VDbGllbnQuYXV0aC5nZXRVc2VyLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0YTogeyB1c2VyOiBtb2NrVXNlciB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrU3VwYWJhc2VDbGllbnQuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgZGF0YTogbW9ja1JvbGVzLFxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFVzZXJXaXRoUm9sZXNTU1IoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHVzZXI6IG1vY2tVc2VyLFxuICAgICAgICBpc0FkbWluOiBmYWxzZSxcbiAgICAgICAgaXNUZWFjaGVyOiBmYWxzZSxcbiAgICAgICAgaXNTdHVkZW50OiB0cnVlLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdObyBVc2VyJywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIGFsbCByb2xlcyBmYWxzZSB3aGVuIG5vIHVzZXIgaXMgYXV0aGVudGljYXRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTdXBhYmFzZUNsaWVudC5hdXRoLmdldFVzZXIubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiB7IHVzZXI6IG51bGwgfSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0VXNlcldpdGhSb2xlc1NTUigpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgdXNlcjogbnVsbCxcbiAgICAgICAgaXNBZG1pbjogZmFsc2UsXG4gICAgICAgIGlzVGVhY2hlcjogZmFsc2UsXG4gICAgICAgIGlzU3R1ZGVudDogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1VzZXIgd2l0aCBObyBSb2xlcycsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyB1c2VyIHdpdGggYWxsIHJvbGVzIGZhbHNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAnbm8tcm9sZXMtdXNlci1pZCcsXG4gICAgICAgIGVtYWlsOiAndXNlckBleGFtcGxlLmNvbScsXG4gICAgICAgIGF1ZDogJ2F1dGhlbnRpY2F0ZWQnLFxuICAgICAgICByb2xlOiAnYXV0aGVudGljYXRlZCcsXG4gICAgICB9O1xuXG4gICAgICBtb2NrU3VwYWJhc2VDbGllbnQuYXV0aC5nZXRVc2VyLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0YTogeyB1c2VyOiBtb2NrVXNlciB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrU3VwYWJhc2VDbGllbnQuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgZGF0YTogW10sIC8vIE5vIHJvbGVzIGZvdW5kXG4gICAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0VXNlcldpdGhSb2xlc1NTUigpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgdXNlcjogbW9ja1VzZXIsXG4gICAgICAgIGlzQWRtaW46IGZhbHNlLFxuICAgICAgICBpc1RlYWNoZXI6IGZhbHNlLFxuICAgICAgICBpc1N0dWRlbnQ6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEYXRhYmFzZSBFcnJvcicsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyB1c2VyIHdpdGggYWxsIHJvbGVzIGZhbHNlIG9uIGVycm9yJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAnZXJyb3ItdXNlci1pZCcsXG4gICAgICAgIGVtYWlsOiAnZXJyb3JAZXhhbXBsZS5jb20nLFxuICAgICAgICBhdWQ6ICdhdXRoZW50aWNhdGVkJyxcbiAgICAgICAgcm9sZTogJ2F1dGhlbnRpY2F0ZWQnLFxuICAgICAgfTtcblxuICAgICAgbW9ja1N1cGFiYXNlQ2xpZW50LmF1dGguZ2V0VXNlci5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgdXNlcjogbW9ja1VzZXIgfSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgbW9ja1N1cGFiYXNlQ2xpZW50LmZyb20ubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnRGF0YWJhc2UgZXJyb3InIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFVzZXJXaXRoUm9sZXNTU1IoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHVzZXI6IG1vY2tVc2VyLFxuICAgICAgICBpc0FkbWluOiBmYWxzZSxcbiAgICAgICAgaXNUZWFjaGVyOiBmYWxzZSxcbiAgICAgICAgaXNTdHVkZW50OiBmYWxzZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGF0YWJhc2UgRXJyb3InLCAoKSA9PiB7XG4gICAgaXQoJ2hhbmRsZXMgcHJvZmlsZSBmZXRjaCBlcnJvciBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAndXNlci1pZCcsXG4gICAgICAgIGVtYWlsOiAndXNlckBleGFtcGxlLmNvbScsXG4gICAgICAgIGF1ZDogJ2F1dGhlbnRpY2F0ZWQnLFxuICAgICAgICByb2xlOiAnYXV0aGVudGljYXRlZCcsXG4gICAgICB9O1xuXG4gICAgICBtb2NrU3VwYWJhc2VDbGllbnQuYXV0aC5nZXRVc2VyLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0YTogeyB1c2VyOiBtb2NrVXNlciB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrU3VwYWJhc2VDbGllbnQuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgICAgICAgZXJyb3I6IHsgY29kZTogJ1BHUlNUNTAwJywgbWVzc2FnZTogJ0RhdGFiYXNlIGVycm9yJyB9LFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFVzZXJXaXRoUm9sZXNTU1IoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHVzZXI6IG1vY2tVc2VyLFxuICAgICAgICBpc0FkbWluOiBmYWxzZSxcbiAgICAgICAgaXNUZWFjaGVyOiBmYWxzZSxcbiAgICAgICAgaXNTdHVkZW50OiBmYWxzZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQXV0aGVudGljYXRpb24gRXJyb3InLCAoKSA9PiB7XG4gICAgaXQoJ3JldHVybnMgbnVsbCB1c2VyIHdoZW4gYXV0aCBmYWlscycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTdXBhYmFzZUNsaWVudC5hdXRoLmdldFVzZXIubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiB7IHVzZXI6IG51bGwgfSxcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ0F1dGggZXJyb3InIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0VXNlcldpdGhSb2xlc1NTUigpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgdXNlcjogbnVsbCxcbiAgICAgICAgaXNBZG1pbjogZmFsc2UsXG4gICAgICAgIGlzVGVhY2hlcjogZmFsc2UsXG4gICAgICAgIGlzU3R1ZGVudDogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJqZXN0IiwibW9jayIsImRlc2NyaWJlIiwibW9ja0Nvb2tpZVN0b3JlIiwiZ2V0QWxsIiwiZm4iLCJzZXQiLCJnZXQiLCJtb2NrU3VwYWJhc2VDbGllbnQiLCJhdXRoIiwiZ2V0VXNlciIsImZyb20iLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsImNvb2tpZXMiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsImNyZWF0ZVNlcnZlckNsaWVudCIsIm1vY2tSZXR1cm5WYWx1ZSIsIml0IiwibW9ja1VzZXIiLCJpZCIsImVtYWlsIiwiYXVkIiwicm9sZSIsIm1vY2tSb2xlcyIsImRhdGEiLCJ1c2VyIiwiZXJyb3IiLCJzZWxlY3QiLCJlcSIsInJlc3VsdCIsImdldFVzZXJXaXRoUm9sZXNTU1IiLCJleHBlY3QiLCJ0b0VxdWFsIiwiaXNBZG1pbiIsImlzVGVhY2hlciIsImlzU3R1ZGVudCIsIm1lc3NhZ2UiLCJzaW5nbGUiLCJjb2RlIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0M7QUFNRCxvQkFBb0I7QUFDcEJBLEtBQUtDLElBQUksQ0FBQztBQUNWRCxLQUFLQyxJQUFJLENBQUM7Ozs7cUNBTjBCO3lCQUNaO3FCQUNXO0FBTW5DQyxTQUFTLHVCQUF1QjtJQUM5QixNQUFNQyxrQkFBa0I7UUFDdEJDLFFBQVFKLEtBQUtLLEVBQUU7UUFDZkMsS0FBS04sS0FBS0ssRUFBRTtRQUNaRSxLQUFLUCxLQUFLSyxFQUFFO0lBQ2Q7SUFFQSxNQUFNRyxxQkFBcUI7UUFDekJDLE1BQU07WUFDSkMsU0FBU1YsS0FBS0ssRUFBRTtRQUNsQjtRQUNBTSxNQUFNWCxLQUFLSyxFQUFFO0lBQ2Y7SUFFQU8sV0FBVztRQUNUWixLQUFLYSxhQUFhO1FBQ2pCQyxnQkFBTyxDQUFlQyxpQkFB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