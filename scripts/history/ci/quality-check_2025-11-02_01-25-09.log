Script: /Users/piotrromanczuk/Desktop/guitar-crm/scripts/ci/quality-check.sh
Timestamp: 2025-11-02 01:25:09
Duration: 28s
Exit Code: 0
Git Branch: feature/song-crud-implementation
Git Commit: 5289899051846808ffcc6eda269330e382560bfe
User: piotrromanczuk
Node Version: v23.11.0
System: Darwin macbookair.home 25.0.0 Darwin Kernel Version 25.0.0: Wed Sep 17 21:41:39 PDT 2025; root:xnu-12377.1.9~141/RELEASE_ARM64_T8103 arm64
----------------------------------------
Output:
üîç CODE QUALITY CHECK
====================
üîß Running TypeScript type check...
[0;32m‚úÖ TypeScript types are valid[0m

üßπ Running ESLint...

> guitar-crm@0.1.0 lint
> eslint


/Users/piotrromanczuk/Desktop/guitar-crm/app/admin/users/page.tsx
  11:16  warning  Function 'UsersPage' has too many lines (179). Maximum allowed is 80  max-lines-per-function

/Users/piotrromanczuk/Desktop/guitar-crm/app/api/dashboard/stats/route.ts
  8:8  warning  Async function 'GET' has too many lines (112). Maximum allowed is 80  max-lines-per-function
  8:8  warning  Async function 'GET' has a complexity of 21. Maximum allowed is 10    complexity

/Users/piotrromanczuk/Desktop/guitar-crm/app/api/song/bulk/route.ts
    9:8  warning  Async function 'POST' has too many lines (152). Maximum allowed is 80  max-lines-per-function
    9:8  warning  Async function 'POST' has a complexity of 19. Maximum allowed is 10    complexity
  114:6  warning  Blocks are nested too deeply (5). Maximum allowed is 4                 max-depth
  137:6  warning  Blocks are nested too deeply (5). Maximum allowed is 4                 max-depth

/Users/piotrromanczuk/Desktop/guitar-crm/app/api/song/export/route.ts
  5:8  warning  Async function 'GET' has too many lines (112). Maximum allowed is 80  max-lines-per-function
  5:8  warning  Async function 'GET' has a complexity of 22. Maximum allowed is 10    complexity

/Users/piotrromanczuk/Desktop/guitar-crm/app/api/song/favorites/route.ts
  5:8  warning  Async function 'GET' has a complexity of 11. Maximum allowed is 10  complexity

/Users/piotrromanczuk/Desktop/guitar-crm/app/api/song/search/route.ts
  6:8  warning  Async function 'GET' has a complexity of 17. Maximum allowed is 10  complexity

/Users/piotrromanczuk/Desktop/guitar-crm/app/api/song/stats/route.ts
  4:8  warning  Async function 'GET' has too many lines (113). Maximum allowed is 80  max-lines-per-function
  4:8  warning  Async function 'GET' has a complexity of 21. Maximum allowed is 10    complexity

/Users/piotrromanczuk/Desktop/guitar-crm/app/api/song/user-songs/route.ts
  4:8  warning  Async function 'GET' has too many lines (201). Maximum allowed is 80  max-lines-per-function
  4:8  warning  Async function 'GET' has a complexity of 26. Maximum allowed is 10    complexity

/Users/piotrromanczuk/Desktop/guitar-crm/app/api/song/user-test-song/route.ts
  4:8  warning  Async function 'GET' has a complexity of 11. Maximum allowed is 10  complexity

/Users/piotrromanczuk/Desktop/guitar-crm/components/SupabaseTest.tsx
  7:16  warning  Function 'SupabaseTest' has too many lines (105). Maximum allowed is 80  max-lines-per-function

/Users/piotrromanczuk/Desktop/guitar-crm/components/admin/UserForm.tsx
  19:8  warning  Function 'UserForm' has too many lines (92). Maximum allowed is 80  max-lines-per-function
  19:8  warning  Function 'UserForm' has a complexity of 15. Maximum allowed is 10   complexity

/Users/piotrromanczuk/Desktop/guitar-crm/components/auth/AuthProvider.tsx
  25:8   warning  Function 'AuthProvider' has a complexity of 17. Maximum allowed is 10  complexity
  57:32  warning  Async arrow function has a complexity of 11. Maximum allowed is 10     complexity

/Users/piotrromanczuk/Desktop/guitar-crm/components/auth/ForgotPasswordForm.tsx
  10:16  warning  Function 'ForgotPasswordForm' has too many lines (106). Maximum allowed is 80  max-lines-per-function

/Users/piotrromanczuk/Desktop/guitar-crm/components/auth/ProtectedRoute.tsx
  14:16  warning  Function 'ProtectedRoute' has a complexity of 11. Maximum allowed is 10  complexity

/Users/piotrromanczuk/Desktop/guitar-crm/components/auth/ResetPasswordForm.tsx
  10:16  warning  Function 'ResetPasswordForm' has too many lines (118). Maximum allowed is 80  max-lines-per-function
  10:16  warning  Function 'ResetPasswordForm' has a complexity of 11. Maximum allowed is 10    complexity

/Users/piotrromanczuk/Desktop/guitar-crm/components/auth/useSignUpLogic.ts
  18:1  warning  Function 'getValidationError' has a complexity of 11. Maximum allowed is 10  complexity

/Users/piotrromanczuk/Desktop/guitar-crm/components/songs/SongDetail.tsx
  16:16  warning  Function 'SongDetail' has too many lines (116). Maximum allowed is 80  max-lines-per-function

/Users/piotrromanczuk/Desktop/guitar-crm/components/songs/SongForm.Content.tsx
  15:16  warning  Function 'SongFormContent' has too many lines (86). Maximum allowed is 80  max-lines-per-function
  15:16  warning  Function 'SongFormContent' has a complexity of 17. Maximum allowed is 10   complexity

/Users/piotrromanczuk/Desktop/guitar-crm/components/songs/SongForm.Fields.tsx
  10:16  warning  Function 'SongFormFields' has too many lines (96). Maximum allowed is 80  max-lines-per-function

/Users/piotrromanczuk/Desktop/guitar-crm/scripts/database/create-test-users.ts
  4:7  warning  'supabaseAnonKey' is assigned a value but never used  @typescript-eslint/no-unused-vars

/Users/piotrromanczuk/Desktop/guitar-crm/scripts/database/seed-assignments.ts
  145:10  warning  'songsByLevel' is assigned a value but never used  @typescript-eslint/no-unused-vars

/Users/piotrromanczuk/Desktop/guitar-crm/set_passwords_from_file.js
  52:11  warning  'err' is defined but never used  @typescript-eslint/no-unused-vars

‚úñ 33 problems (0 errors, 33 warnings)

[0;32m‚úÖ ESLint passed[0m

üß™ Running tests...

> guitar-crm@0.1.0 test
> jest --passWithNoTests --watchAll=false

PASS __tests__/components/auth/RequireRole.test.tsx
PASS __tests__/components/navigation/Header.test.tsx
PASS __tests__/components/auth/ForgotPasswordForm.test.tsx
PASS __tests__/components/auth/AuthProvider.test.tsx
  ‚óè Console

    console.error
      An update to AuthProvider inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      37 | 			setSession(session);
      38 | 			setUser(session?.user ?? null);
    > 39 | 			setLoading(false);
         | 			^
      40 | 		});
      41 |
      42 | 		// Listen for auth changes

      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setLoading (components/auth/AuthProvider.tsx:39:4)

    console.error
      An update to AuthProvider inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      37 | 			setSession(session);
      38 | 			setUser(session?.user ?? null);
    > 39 | 			setLoading(false);
         | 			^
      40 | 		});
      41 |
      42 | 		// Listen for auth changes

      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setLoading (components/auth/AuthProvider.tsx:39:4)

    console.error
      An update to AuthProvider inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      70 | 			if (error) {
      71 | 				// Fall back silently to user metadata if fetching profile fails due to RLS or network
    > 72 | 				setProfileRoles(null);
         | 				^
      73 | 				return;
      74 | 			}
      75 |

      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setProfileRoles (components/auth/AuthProvider.tsx:72:5)

PASS __tests__/components/auth/SignInForm.test.tsx
PASS __tests__/components/auth/ResetPasswordForm.test.tsx
PASS __tests__/components/auth/SignUpForm.test.tsx
PASS __tests__/components/songs/SongForm.test.tsx
PASS __tests__/components/songs/SongDetail.test.tsx
  ‚óè Console

    console.error
      An update to SongDetail inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      34 |
      35 | 			if (fetchError || !data || data.length === 0) {
    > 36 | 				setError('Song not found');
         | 				^
      37 | 				return;
      38 | 			}
      39 |

      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setError (components/songs/SongDetail.tsx:36:5)

    console.error
      An update to SongDetail inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      42 | 			setError('Failed to load song');
      43 | 		} finally {
    > 44 | 			setLoading(false);
         | 			^
      45 | 		}
      46 | 	}, [songId]);
      47 |

      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setLoading (components/songs/SongDetail.tsx:44:4)

PASS __tests__/components/admin/index.test.tsx
PASS __tests__/api/song/integration.test.ts
PASS __tests__/api/song/handlers.test.ts
PASS __tests__/components/auth/ProtectedRoute.test.tsx
PASS __tests__/setup.test.ts
PASS __tests__/schemas/SongSchema.test.ts
PASS __tests__/components/songs/SongList.test.tsx

Test Suites: 16 passed, 16 total
Tests:       171 passed, 171 total
Snapshots:   0 total
Time:        5.151 s
Ran all test suites.
[0;32m‚úÖ All tests passed[0m

üìù Checking for TODO/FIXME comments...
grep: ./node_modules/decimal.js: Is a directory
[1;33m‚ö†Ô∏è  Found     4614 TODO/FIXME comments[0m
./app/api/dashboard/stats/route.ts:86:					studentProgress: 0, // TODO: Calculate average progress
./app/api/dashboard/stats/route.ts:116:					progress: 0, // TODO: Calculate progress percentage
./app/page.tsx:47:	// TODO: Replace this redirect logic with the smart dashboard index
./node_modules/jest-runtime/node_modules/jest-util/build/specialChars.js:21:  todo: '\u270E'
./node_modules/jest-runtime/node_modules/jest-util/build/index.d.ts:72:  todo: string;
./node_modules/jest-runtime/node_modules/jest-message-util/build/index.js:365:          // TODO: check & read HasteFS instead of reading the filesystem:
./node_modules/jest-runtime/node_modules/jest-mock/build/index.js:28:// TODO remove re-export in Jest 30
./node_modules/jest-runtime/node_modules/jest-mock/build/index.js:30:// TODO remove re-export in Jest 30
./node_modules/jest-runtime/node_modules/jest-mock/build/index.js:32:// TODO in Jest 30 remove `SpyInstance` in favour of `Spied`
./node_modules/jest-runtime/build/index.js:278:    // TODO: make mandatory in Jest 30
xargs: grep: terminated with signal 13; aborting
... and 4604 more

üß© Checking component file sizes (advisory)...
[1;33m‚ö†Ô∏è  The following files exceed 300 lines:[0m
app/api/song/route.ts (     301 lines)
Consider splitting into smaller, composable components.

üì¶ Checking bundle size...
220K	.next/static/chunks/58e77fc17acbf1e7.js
184K	.next/static/chunks/2b732d6920fda0b7.js
124K	.next/static/chunks/6fe7031d98ed9c0a.js
112K	.next/static/chunks/a6dad97d9634a72d.js
 84K	.next/static/chunks/fb283c6c0a1825c5.js


üóÑÔ∏è Running Database Quality Check...
[0;34müîç DATABASE QUALITY CHECK[0m
======================

[0;34müì° Checking Supabase status...[0m
[0;32m‚úÖ Supabase is running[0m

[0;34müîç Checking test data integrity...[0m

[1;33mChecking test users:[0m
Test users count:      5

[1;33mChecking for real emails (should be 0):[0m
[0;32m‚úÖ No real emails found[0m

[1;33mChecking songs:[0m
Total songs:     15
Difficulty distribution:
 beginner     |     5
 intermediate |     7
 advanced     |     3


[1;33mChecking lessons:[0m
Total lessons:      3

[1;33mChecking lesson-songs:[0m
Total lesson-song associations:     15

[1;33mChecking assignments:[0m
Total assignments:     28
Assignment status distribution:
 not_started |     8
 in_progress |    10
 completed   |     6
 overdue     |     4


[1;33mAverage practice minutes by song level:[0m
 beginner     |          39 |                7
 intermediate |          40 |               13
 advanced     |          55 |                8

[1;33m‚ö†Ô∏è       6 completed assignments pending review[0m

[1;33mChecking for orphaned records:[0m
[0;32m‚úÖ No orphaned lesson-song records[0m

[1;33mChecking profiles:[0m
Total profiles:      5
Role distribution:
           1 |             1 |             3


[0;34müìä DATABASE SUMMARY[0m
======================
Test Users:      5
Songs:     15
Lessons:      3
Lesson-Song Associations:     15
Profiles:      5

[0;32m‚úÖ DATABASE QUALITY CHECK PASSED[0m
[0;32m‚úÖ Database quality check passed[0m

üö¢ Checking for Lighthouse audit availability...
[1;33müí° Start dev server (npm run dev) and run: npm run lighthouse[0m

======================
[0;32müéâ ALL QUALITY CHECKS PASSED![0m
Your code is ready for commit.

real	0m28.588s
user	0m33.472s
sys	0m8.259s
