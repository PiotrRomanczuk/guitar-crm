/// <reference types="cypress" />

/**
 * Smoke Tests - Critical Path Verification
 *
 * Fast, essential tests that verify the application loads and core features work.
 * These should run in under 30 seconds and catch deployment-breaking issues.
 */

describe('Application Health Smoke Tests', () => {
  const ADMIN_EMAIL = Cypress.env('TEST_ADMIN_EMAIL');
  const ADMIN_PASSWORD = Cypress.env('TEST_ADMIN_PASSWORD');

  beforeEach(() => {
    cy.viewport(1280, 720);
  });

  it('app loads and renders without errors', () => {
    cy.visit('/');
    cy.contains('Guitar CRM').should('exist');
    cy.get('body').should('be.visible');
  });

  it('authentication system works', () => {
    cy.visit('/sign-in');
    cy.get('[data-testid="email"]').should('be.visible');
    cy.get('[data-testid="password"]').should('be.visible');

    // Quick auth check (no full login flow)
    cy.get('[data-testid="signin-button"]').should('be.enabled');
  });

  it('admin dashboard is accessible', () => {
    cy.login(ADMIN_EMAIL, ADMIN_PASSWORD);
    cy.visit('/dashboard');

    // Verify core dashboard elements load
    cy.contains(/dashboard|overview/i).should('be.visible');
    cy.get('[data-testid="stat-card"], .stat-card, [class*="card"]').should('have.length.gte', 1);
  });

  it('navigation menu renders correctly', () => {
    cy.login(ADMIN_EMAIL, ADMIN_PASSWORD);
    cy.visit('/dashboard');

    // Check main navigation exists
    cy.get('nav, [role="navigation"], .sidebar').should('exist');
  });

  it('core CRUD endpoints respond', () => {
    cy.login(ADMIN_EMAIL, ADMIN_PASSWORD);

    // Quick API health checks
    cy.request('/api/lessons').then((response) => {
      expect(response.status).to.equal(200);
    });

    cy.request('/api/song').then((response) => {
      expect(response.status).to.equal(200);
    });
  });
});
